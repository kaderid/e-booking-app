<div class="dashboard-container">
  <!-- Toolbar -->
  <mat-toolbar color="primary" class="toolbar">
    <div class="logo-container" routerLink="/home">
      <mat-icon class="toolbar-icon">business</mat-icon>
      <span class="toolbar-title">S&K-BookingPro</span>
    </div>
    <span class="spacer"></span>
    <button mat-raised-button color="accent" routerLink="/prestataire/dashboard" class="dashboard-button">
      <mat-icon>dashboard</mat-icon>
      Mon Dashboard
    </button>
    <span class="user-info">
      <mat-icon>person</mat-icon>
      {{ currentUser?.prenom }} {{ currentUser?.nom }}
    </span>
    <button mat-icon-button [matMenuTriggerFor]="menu">
      <mat-icon>more_vert</mat-icon>
    </button>
    <mat-menu #menu="matMenu">
      <button mat-menu-item (click)="logout()">
        <mat-icon>exit_to_app</mat-icon>
        <span>Déconnexion</span>
      </button>
    </mat-menu>
  </mat-toolbar>

  <!-- Main Content -->
  <div class="main-content">
    <div class="welcome-section">
      <h1 class="welcome-title">Tableau de bord Professionnel</h1>
      <p class="welcome-subtitle">{{ prestataire?.nom }} - {{ prestataire?.specialite }}</p>
    </div>

    <!-- Statistics Cards -->
    <div class="stats-grid">
      <mat-card class="stat-card total">
        <div class="stat-icon">
          <mat-icon>event</mat-icon>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ stats.totalRendezVous }}</div>
          <div class="stat-label">Total Rendez-vous</div>
        </div>
      </mat-card>

      <mat-card class="stat-card attente">
        <div class="stat-icon">
          <mat-icon>schedule</mat-icon>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ stats.enAttente }}</div>
          <div class="stat-label">En Attente</div>
        </div>
      </mat-card>

      <mat-card class="stat-card confirme">
        <div class="stat-icon">
          <mat-icon>check_circle</mat-icon>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ stats.confirmes }}</div>
          <div class="stat-label">Confirmés</div>
        </div>
      </mat-card>

      <mat-card class="stat-card termine">
        <div class="stat-icon">
          <mat-icon>done_all</mat-icon>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ stats.termines }}</div>
          <div class="stat-label">Terminés</div>
        </div>
      </mat-card>
    </div>

    <!-- Tabs -->
    <mat-tab-group [(selectedIndex)]="selectedTab" class="content-tabs">
      <!-- Rendez-vous Tab -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">event</mat-icon>
          <span [matBadge]="stats.enAttente" [matBadgeHidden]="stats.enAttente === 0">
            Mes rendez-vous
          </span>
        </ng-template>
        <div class="tab-content">
          <div *ngIf="rendezVous.length === 0" class="empty-state">
            <mat-icon class="empty-icon">event_busy</mat-icon>
            <h3>Aucun rendez-vous</h3>
            <p>Vous n'avez pas encore de rendez-vous planifiés.</p>
          </div>

          <div *ngIf="rendezVous.length > 0" class="rendez-vous-container">
            <mat-card *ngFor="let rdv of rendezVous" class="rendez-vous-card">
              <div class="rdv-header">
                <div class="rdv-date">
                  <mat-icon>calendar_today</mat-icon>
                  <span>{{ rdv.date | date: 'dd/MM/yyyy' }} à {{ rdv.heure }}</span>
                </div>
                <mat-chip [class]="getStatutClass(rdv.statut || 'EN_ATTENTE')">
                  {{ rdv.statut }}
                </mat-chip>
              </div>
              <mat-card-content>
                <div class="rdv-details">
                  <div class="rdv-info">
                    <mat-icon>build</mat-icon>
                    <span>{{ rdv.serviceNom || 'Service #' + rdv.serviceId }}</span>
                  </div>
                  <div class="rdv-info">
                    <mat-icon>person</mat-icon>
                    <span>{{ rdv.clientPrenom }} {{ rdv.clientNom }}</span>
                  </div>
                </div>
              </mat-card-content>
              <mat-card-actions>
                <button mat-raised-button color="primary"
                        *ngIf="rdv.statut === 'EN_ATTENTE'"
                        (click)="confirmerRendezVous(rdv)">
                  <mat-icon>check</mat-icon>
                  Confirmer
                </button>
                <button mat-button color="warn"
                        *ngIf="rdv.statut === 'EN_ATTENTE' || rdv.statut === 'CONFIRME'"
                        (click)="annulerRendezVous(rdv)">
                  <mat-icon>cancel</mat-icon>
                  Annuler
                </button>
              </mat-card-actions>
            </mat-card>
          </div>
        </div>
      </mat-tab>

      <!-- Services Tab -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">build</mat-icon>
          Mes Services
        </ng-template>
        <div class="tab-content">
          <div class="services-header">
            <h2>Services proposés</h2>
            <button mat-raised-button color="primary" (click)="openAddServiceDialog()">
              <mat-icon>add</mat-icon>
              Ajouter un service
            </button>
          </div>

          <div *ngIf="services.length === 0" class="empty-state">
            <mat-icon class="empty-icon">build_circle</mat-icon>
            <h3>Aucun service</h3>
            <p>Commencez par ajouter vos premiers services.</p>
          </div>

          <div *ngIf="services.length > 0" class="services-grid">
            <mat-card *ngFor="let service of services" class="service-card">
              <mat-card-header>
                <mat-icon mat-card-avatar class="service-icon">build_circle</mat-icon>
                <mat-card-title>{{ service.nom }}</mat-card-title>
                <mat-card-subtitle>{{ service.description }}</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <div class="service-details">
                  <div class="detail-item">
                    <mat-icon>schedule</mat-icon>
                    <span>{{ service.duree }} minutes</span>
                  </div>
                  <div class="detail-item">
                    <mat-icon>euro</mat-icon>
                    <span>{{ service.prix }} €</span>
                  </div>
                </div>
              </mat-card-content>
              <mat-card-actions>
                <button mat-button color="primary" (click)="editService(service)">
                  <mat-icon>edit</mat-icon>
                  Modifier
                </button>
                <button mat-button color="warn" (click)="deleteService(service)">
                  <mat-icon>delete</mat-icon>
                  Supprimer
                </button>
              </mat-card-actions>
            </mat-card>
          </div>
        </div>
      </mat-tab>

      <!-- Disponibilités Tab -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">access_time</mat-icon>
          Disponibilités
        </ng-template>
        <div class="tab-content">
          <div class="disponibilites-header">
            <h2>Gérer vos disponibilités</h2>
            <button mat-raised-button color="primary" (click)="openAddDisponibiliteDialog()">
              <mat-icon>add</mat-icon>
              Ajouter une disponibilité
            </button>
          </div>

          <div *ngIf="disponibilites.length === 0" class="empty-state">
            <mat-icon class="empty-icon">event_available</mat-icon>
            <h3>Aucune disponibilité</h3>
            <p>Configurez vos horaires de disponibilité pour recevoir des rendez-vous.</p>
          </div>

          <div *ngIf="disponibilites.length > 0" class="disponibilites-list">
            <mat-card *ngFor="let dispo of disponibilites" class="disponibilite-card">
              <mat-card-content>
                <div class="dispo-header">
                  <h3>{{ getJourLabel(dispo.jourSemaine) }}</h3>
                </div>
                <div class="dispo-horaires">
                  <div class="horaire-item">
                    <mat-icon>wb_sunny</mat-icon>
                    <span>{{ dispo.heureDebut }} - {{ dispo.heureFin }}</span>
                  </div>
                </div>
              </mat-card-content>
              <mat-card-actions>
                <button mat-button color="primary" (click)="editDisponibilite(dispo)">
                  <mat-icon>edit</mat-icon>
                  Modifier
                </button>
                <button mat-button color="warn" (click)="deleteDisponibilite(dispo)">
                  <mat-icon>delete</mat-icon>
                  Supprimer
                </button>
              </mat-card-actions>
            </mat-card>
          </div>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>
</div>
